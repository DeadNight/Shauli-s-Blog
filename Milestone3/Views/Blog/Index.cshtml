@model IEnumerable<Milestone3.Models.Post>

@{
    ViewBag.Title = "Blog";
    Culture = UICulture = "en-US";
}

@section AddToHead{
    @Styles.Render("~/Content/style/blog.css")
}

@foreach(var post in Model)
{
    var textLength1 = post.Text.IndexOf('.', post.Text.Length / 4) + 1;
    var textLength2 = post.Text.IndexOf('.', post.Text.Length * 3 / 4) + 1 - textLength1;
    var textPart1 = post.Text.Substring(0, textLength1);
    var textPart2 = post.Text.Substring(textLength1 + 1, textLength2);
    var textPart3 = post.Text.Substring(textLength2 + 1);
    <section>
        <article class="blogPost">
            <header>
                <h2>@Html.DisplayFor(modelItem => post.Title)</h2>
                <p>
                    Posted on <time datetime="@(post.PublishDate.ToString("s") + post.PublishDate.ToString("zzz"))">@Html.DisplayFor(modelItem => post.FormattedPublishDate)</time>
                    by <a href="@post.AuthorWebsite">@Html.DisplayFor(modelItem => post.AuthorName)</a>
                    - <a href="#comments">@post.Comments.Count comments</a>
</p>
            </header>
            <div>
                <p>@textPart1</p>
                @if (!string.IsNullOrWhiteSpace(post.ImageUrl))
                {
                    <img src="@post.ImageUrl" />
                }
                <p>@textPart2</p>
                @if(!string.IsNullOrWhiteSpace(post.VideoUrl))
                {
                    <video controls>
                        <source src="@post.VideoUrl" type="video/mp4" />
                        Your browser does not support the video tag.
                    </video>
                }
                <p>@textPart3</p>
            </div>
        </article>
    </section>

    <section id="comments">
        <h3>Comments</h3>
        @foreach(var comment in post.Comments)
        {
            <article>
                <header>
                    <h4>@comment.Title</h4>
                    <p>
                        <a href="@comment.AuthorWebsite">@comment.AuthorName</a>
                        on <time datetime="@(comment.PublishDate.ToString("s") + comment.PublishDate.ToString("zzz"))">@Html.DisplayFor(modelItem => comment.FormattedPublishDate)</time>
                    </p>
                </header>
                <p>@comment.Text</p>
            </article>
        }
    </section>
}

<form action="#" method="post">
    <h3>Post a comment</h3>
    <p>
        <label for="name">Name</label>
        <input name="name" id="name" type="text" required />
    </p>
    <p>
        <label for="email">E-mail</label>
        <input name="email" id="email" type="email" required />
    </p>
    <p>
        <label for="website">Website</label>
        <input name="website" id="website" type="url" />
    </p>
    <p>
        <label for="comment">Comment</label>
        <textarea name="comment" id="comment" required></textarea>
    </p>
    <p><input type="submit" value="Post comment" /></p>
</form>
